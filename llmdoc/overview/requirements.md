# 核心需求规格

## 功能需求 (Functional Requirements)

### FR-1: 屏幕捕获
| ID | 需求描述 | 优先级 |
|----|---------|-------|
| FR-1.1 | 每 2 秒捕获一次 1080p 屏幕快照 | P0 |
| FR-1.2 | 支持多显示器环境 | P1 |
| FR-1.3 | 支持指定捕获特定应用窗口 | P2 |
| FR-1.4 | 捕获时记录焦点程序与窗口标题 | P0 |

### FR-2: OCR 处理
| ID | 需求描述 | 优先级 |
|----|---------|-------|
| FR-2.1 | 实时 OCR 提取屏幕文本 | P0 |
| FR-2.2 | 支持中英文混排识别 | P0 |
| FR-2.3 | 保留文本位置坐标信息 | P1 |
| FR-2.4 | OCR 延迟 < 500ms | P0 |

### FR-3: 语义索引
| ID | 需求描述 | 优先级 |
|----|---------|-------|
| FR-3.1 | 文本向量化支持语义搜索 | P0 |
| FR-3.2 | 图像向量化支持以图搜图 | P1 |
| FR-3.3 | 全文检索支持关键词搜索 | P0 |
| FR-3.4 | 混合检索 (向量 + 全文) | P1 |

### FR-4: 智能摘要
| ID | 需求描述 | 优先级 |
|----|---------|-------|
| FR-4.1 | 周期性生成活动摘要 (15min/1h/1d) | P0 |
| FR-4.2 | 提取结构化实体 (人名、项目、链接) | P1 |
| FR-4.3 | 生成可读的 Markdown 工作日志 | P1 |

### FR-5: 隐私保护
| ID | 需求描述 | 优先级 |
|----|---------|-------|
| FR-5.1 | 应用黑名单 (密码管理器自动排除) | P0 |
| FR-5.2 | 浏览器隐私模式自动暂停 | P0 |
| FR-5.3 | 自然语言描述的语义黑名单 | P1 |
| FR-5.4 | 数据库 AES-256 加密 | P1 |

### FR-6: 外部接口
| ID | 需求描述 | 优先级 |
|----|---------|-------|
| FR-6.1 | MCP 协议服务端支持 | P0 |
| FR-6.2 | search_memory 工具 | P0 |
| FR-6.3 | get_app_activity 工具 | P1 |
| FR-6.4 | 实时屏幕资源 engram://screen/current | P1 |

### FR-7: 用户界面
| ID | 需求描述 | 优先级 |
|----|---------|-------|
| FR-7.1 | 时间线视图浏览历史截图 | P0 |
| FR-7.2 | 搜索界面 (关键词 + 语义) | P0 |
| FR-7.3 | 设置界面 (黑名单、频率、存储) | P0 |
| FR-7.4 | 系统托盘常驻 | P0 |
| FR-7.5 | 摘要查看界面 | P1 |

## 非功能需求 (Non-Functional Requirements)

### NFR-1: 性能
| ID | 需求描述 | 目标值 |
|----|---------|-------|
| NFR-1.1 | 截图 + OCR 端到端延迟 | < 1000ms |
| NFR-1.2 | 空闲时 CPU 占用 | < 2% |
| NFR-1.3 | 工作时 CPU 占用 | < 10% |
| NFR-1.4 | 内存基线 | < 200MB |
| NFR-1.5 | 内存峰值 (含 AI 模型) | < 500MB |

### NFR-2: 兼容性
| ID | 需求描述 |
|----|---------|
| NFR-2.1 | Windows 10 (1903+) / Windows 11 |
| NFR-2.2 | macOS 12.3+ (含 Apple Silicon) |
| NFR-2.3 | Linux (Ubuntu 22.04+, Wayland/X11) |

### NFR-3: 存储
| ID | 需求描述 | 目标值 |
|----|---------|-------|
| NFR-3.1 | 单帧存储 (WebP 压缩) | < 100KB |
| NFR-3.2 | 日均存储 (8h 工作) | < 1GB |
| NFR-3.3 | 去重后存储节省 | > 60% |

### NFR-4: 可靠性
| ID | 需求描述 |
|----|---------|
| NFR-4.1 | 开机自启动 |
| NFR-4.2 | 崩溃自动重启 |
| NFR-4.3 | 数据库损坏自动修复 |

## 约束条件

1. **零云依赖**: 核心功能不依赖任何外部 API
2. **单进程优先**: 尽量避免多进程架构带来的复杂性
3. **渐进增强**: 低配硬件可降级运行 (禁用向量搜索/摘要)
